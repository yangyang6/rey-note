#  多线程



关于HashMap

首先HashMap是线程不安全的，其主要体现：

1.在JDK1.7中，在多线程环境下，扩容时会造成环形链路或数据丢失

2.在JDK1.8中，在多线程环境下，会发生数据覆盖的情况（在putVal()中， 如果没有hash碰撞则直接插入元素）



ConcurrentHashMap

1.在1.8之前采用分段锁，尽量降低同步锁的粒度

2.在1.8之后采用CAS思想代替冗杂的分段锁实现



CAS采用乐观锁思想达到lock free，Unsafe的native方法，至于CAS的其他应用可以聊一聊Atomic元子类和一些无锁并发框架(如Amino)，提到ABA问题加分

ABA问题 就是线程1准备将变量的值由A变成B，但是线程2已经把变量A的值变成C，又由C替换成A，这样线程1去操作的时候发现变量的值仍为A，所以CAS成功



乐观锁的实现会加版本号来对对象记录操作标记，java就用到了AtomicStampedReference类

通过join()保证线程之间的执行顺序



