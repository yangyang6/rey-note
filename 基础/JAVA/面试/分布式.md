# 分布式事务

### 2PC 二阶段提交

2PC就是二阶段提交，分别有协调者和参与者两个角色，二阶段分别是准备阶段和提交阶段



2PC只适用于数据库层面的事务，如果你想在数据库里面写一条数据同时又要上传一张图片，这两个操作2PC无法保证满足事务的约束

2PC是强一致性的分布式事务，它是同步阻塞的

总体而言效率低，并且存在单点故障问题，协调者就是那个单点，并且在极端条件下存在数据不一致的风险



### TCC

TCC能保证业务层面的事务，也就是说它不仅仅是数据库层面，上面的上传图片这种操作它也能做

TCC分为三个阶段 try-confirm-cancel，每个业务都需要这三个方法

TCC其实对业务的耦合性很大，这是TCC的缺点，并且confirm和cancel操作要注意幂等





### 事务消息

它主要是适用于异步更新的场景，并且对数据实时性要求不高的地方

它的目的是为了解决消息生产者与消费者的数据一致性问题

使用场景：下单和购物车的数据清空

RocketMq事务消息实现：

![image-20211119104609601](/Users/yangli/Library/Application Support/typora-user-images/image-20211119104609601.png)





### SAGA

SAGA事务的思路是每个操作都需要设计一个补偿操作，一旦事务执行失败，则需要通过补偿操作来进行补偿。









